{
  "id": "opportunity-attack",
  "name": "Opportunity Attack",
  "summary": "Strike a hostile that leaves your reach.",
  "uiMessage": "Vous avez subi une attaque d opportunite.",
  "uiMessageMiss": "Vous avez evite une attaque d opportunite.",
  "trigger": {
    "event": "movement.leave_reach",
    "source": "hostile"
  },
  "conditions": [
    { "type": "actor_alive", "reason": "Reactor must be alive." },
    { "type": "reaction_available", "reason": "Reaction already used." },
    { "type": "target_visible", "reason": "Target not visible." }
  ],
  "action": {
    "id": "reaction-opportunity-attack",
    "name": "Opportunity Attack",
    "summary": "Melee strike triggered by a fleeing target.",
    "category": "reaction",
    "actionCost": { "actionType": "reaction", "movementCost": 0 },
    "targeting": {
      "target": "hostile",
      "range": { "min": 0, "max": 1, "shape": "single" },
      "maxTargets": 1,
      "requiresLos": true
    },
    "usage": { "perTurn": 1, "perEncounter": null, "resource": null },
    "conditions": [
      { "type": "target_alive", "target": "primary", "reason": "Target must be alive." }
    ],
    "attack": { "bonus": 5, "critRange": 20 },
    "damage": { "formula": "attackDamage", "critRule": "double-dice", "damageType": "slashing" },
    "effects": [
      { "type": "damage", "target": "primary", "formula": "attackDamage", "damageType": "slashing" },
      { "type": "log", "message": "Opportunity attack triggered." }
    ],
    "tags": ["reaction", "melee", "opportunity"]
  },
  "tags": ["reaction"]
}
